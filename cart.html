<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Carrito · TSF Shop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="tsf-header">
    <div class="tsf-header-inner">
      <div class="logo">
        <span class="logo-main">TSF</span>
        <span class="logo-sub">SHOP</span>
      </div>
      <nav class="nav">
        <a href="index.html">Inicio</a>
        <a href="index.html#colecciones">Colecciones</a>
        <a href="index.html#destacados">Destacados</a>
        <a href="cart.html" class="btn-cart">Carrito</a>
      </nav>
    </div>
  </header>

  <main class="section">
    <h1>Tu carrito</h1>

    <ul id="cart-items" class="cart-items"></ul>

    <div class="cart-summary">
      <p>Total USD: <span id="cart-total">0</span></p>
    </div>

    <!-- BOTONES DE PAGO -->
    <div class="checkout-buttons">

      <!-- Pagar con Stripe -->
      <button id="btn-stripe" class="btn-primary">
        Pagar en USD (Stripe)
      </button>

      <!-- Pagar con USDT -->
      <button id="btn-usdt" class="btn-secondary">
        Pagar con USDT (BEP20)
      </button>

      <!-- Pagar con Mercado Pago -->
      <button id="btn-mp" class="btn-primary">
        Pagar en ARS (Mercado Pago)
      </button>

    </div>
  </main>

  <footer class="tsf-footer">
    <p>© 2025 TSF SHOP · Trading Sin Fronteras</p>
  </footer>

  <script src="script.js"></script>

  <script>
    /* ============================
       CARGAR CARRITO EN LA PÁGINA
    ============================ */

    function loadCart() {
      const cart = JSON.parse(localStorage.getItem("tsfCart")) || [];
      const container = document.getElementById("cart-items");
      const total = document.getElementById("cart-total");

      container.innerHTML = "";

      let sum = 0;

      cart.forEach((item, i) => {
        sum += item.price * item.qty;

        const li = document.createElement("li");
        li.classList.add("cart-item");

        li.innerHTML = `
          <div>
            <strong>${item.name}</strong><br>
            Cantidad: ${item.qty}<br>
            Precio: USD ${item.price}
          </div>
        `;

        container.appendChild(li);
      });

      total.textContent = sum.toFixed(2);
    }

    loadCart();

    /* ============================
       BOTÓN STRIPE
    ============================ */
    document.getElementById("btn-stripe").addEventListener("click", async () => {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];

      const res = await fetch(`${API_BASE}/api/stripe-checkout`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ items: cart })
      });

      const data = await res.json();

      if (data.url) {
        window.location.href = data.url;
      } else {
        alert("Error al iniciar pago con Stripe");
      }
    });

    /* ============================
       BOTÓN USDT
    ============================ */
    document.getElementById("btn-usdt").addEventListener("click", () => {
      alert(
        "Para pagar con USDT (BEP20) envía el monto total a:\n\n" +
        USDT_WALLET +
        "\n\nLuego envía el comprobante por WhatsApp."
      );
    });

    /* ============================
       BOTÓN MERCADO PAGO
    ============================ */
    document.getElementById("btn-mp").addEventListener("click", async () => {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];

      if (cart.length === 0) {
        alert("El carrito está vacío");
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/api/mp-checkout`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ items: cart })
        });

        const data = await res.json();

        if (data.init_point) {
          window.location.href = data.init_point;
        } else {
          alert("Error creando orden en Mercado Pago");
          console.log(data);
        }
      } catch (e) {
        alert("Error conectando con Mercado Pago");
        console.log(e);
      }
    });

  </script>
</body>
</html>
